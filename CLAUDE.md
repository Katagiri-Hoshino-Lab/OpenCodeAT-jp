# OpenCodeAT 共通ルール (全エージェントが最初に読むべき指示)

## 基本理念
我々はチームとして連携し、HPC環境におけるコードの自動最適化という単一の目標を達成するために協力する。各エージェントは自身の役割に専念し、他のエージェントの専門性を尊重する。報告・連絡・相談を密に行い、プロジェクト全体の進捗を最大化する。

## コミュニケーション
- **基本ツール**: `agent-send.sh [宛先] "[メッセージ]"` を使用する。
- **メッセージ形式**: `[メッセージ種別] [要件/結果の概要] (詳細)` の形式で送ること。
  - 例: `[依頼] コンパイル mat-mat-noopt_v1.2.c`
  - 例: `[報告] コンパイル成功 mat-mat-noopt_v1.2.c (ジョブID: 12345)`
- **非同期通信**: 応答を待つ間も、緊急な他タスクは進めること。

## 📂ファイルとディレクトリ
- `cd`コマンドでの自主的な移動は禁止。全てのファイルパスはプロジェクトルートからの相対パスで指定する。
- **情報源**:
    - `Agent-shared/`以下の全てのファイルに適宜、目を通すこと。最新の階層構造（エージェント配置）などが含まれている。ただし.pyの中身まで参照する必要はない。
    - `BaseCode/`はRead Onlyの既存コードである。オリジナルが完璧でない可能性に留意せよ
    - `changes.md`: 各PGの試行錯誤の記録。
    - `_remote_info/`: スパコン固有情報。

## 🤖あなたの役割
- **PM (Project Manager)**: @instructions/PM.md - プロジェクト全体の管理・要件定義・リソース配分
- **SE (System Engineer)**: @instructions/SE.md - システム設計・worker監視・統計分析
- **CI (Continuous Integration)**: @instructions/CI.md - SSH接続・環境構築・リモート実行
- **PG (Program Generator)**: @instructions/PG.md - コード生成・最適化実装
- **CD (Code Deployment)**: @instructions/CD.md - GitHub管理・セキュリティ対応
- **ID (Information Display)**: @instructions/ID.md - エージェント配置の可視化・STATUSペイン表示

## 基本フロー
PM → SE → CI ↔ PG → PM
CD は必要に応じて非同期で動作

## プロジェクトのディレクトリ階層（組織図）
Agent-shared\directory_map.txtを最初に読み込み
pwdなどのコマンドで自分のカレントディレクトリと
与えられた役割にずれが無いことを確認すること。
組織図は更新されるので、適宜参照すること

## 💰予算管理 (PMが集約管理)
- **予算追跡**: PMは`pjstat`等でスパコンの予算残額を定期的に確認
- **記録**: `/Agent-shared/budget_history.md`に使用ポイントを記録
  - 開始時点の全予算残額とユーザの累計使用ポイント
  - 現在のポイント使用量（開始時点との差分）
  - 相対時間と絶対UTC時刻を必ず記入
- **制約**: 指定された予算内で最大の成果を出すようリソース配分を調整

## 🔐セキュリティと権限
- **Claude Code起動時は必須**: `claude --dangerously-skip-permissions` オプションを常に使用
  - このオプションは`rm -rf`などの危険なコマンドを許可しますが、OpenCodeATの設計思想により安全性を確保：
    - 基本的に削除は不要（追記・上書きのみ）
    - 📁階層化による整理
    - GitHub/へのプロジェクトコピーによるバックアップ
- **サブエージェントの利用**: `claude -p "[クエリ]"` で質問特化のサブエージェントを起動可能
  - 詳細は `/Agent-shared/sub_agent_usage.md` を参照
  - 大量のログデータや画像を扱う際は積極的に使用すること 